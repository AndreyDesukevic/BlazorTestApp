@inject IClientService clientService
@page "/allClients"
@using BlazorTestApp.DAL.DbModels

<MessageComponent Message="@messageForPopUp" @ref="messageComponent"></MessageComponent>
<div class="container-fluid">
    <div class="row">
        <div class="col">
            <h2> All clients</h2>
            <TableComponent Items="_clients.ToList()" Context="client">
                <TableHeader>
                    <th>Id</th>
                    <th>Name</th>
                    <th>Description</th>
                    <th>Create Data</th>
                    <th>Status</th>
                    <th></th>
                </TableHeader>
                <RowTemplate>
                    <td>@client.Id</td>
                    <td><a href="/client/@client.Id"> @client.FirstName @client.LastName</a></td>
                    <td>@client.Description</td>
                    <td>@client.DateCreate</td>
                    <td>@client.ClientStatus</td>
                    <td><button class="btn btn-danger" @onclick="(()=>DeleteClient(client))">Delete Client</button></td>
                </RowTemplate>
            </TableComponent>
        </div>
    </div>
</div>

@code {
    private MessageComponent? messageComponent;
    private string? messageForPopUp;
    private IEnumerable <Client> _clients = new List<Client>();

    protected override void OnInitialized()
    {
        _clients = clientService.GetAll();
    }
    private void DeleteClient(Client client)
    {
        if (clientService.Delete(client))
        {
            messageForPopUp = "Client has been removed";
            messageComponent?.Show();
        }
        else
        {
           messageForPopUp = "Client can't be deleted. He has ordered.";
           messageComponent?.Show();  
        }
       
    }
}